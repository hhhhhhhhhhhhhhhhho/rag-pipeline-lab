# RAG Pipeline Lab

RAG ì‹œìŠ¤í…œ ì‹¤í—˜ì„ ìœ„í•œ ê¸°ëŠ¥ë³„ ëª¨ë“ˆí™”í•œ ë ˆí¬ì§€í† ë¦¬ì…ë‹ˆë‹¤. 

## ğŸ—ï¸ ì‹œìŠ¤í…œ êµ¬ì¡°ë„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        RAG Pipeline Lab                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ Document    â”‚    â”‚ Vector      â”‚    â”‚ LLM         â”‚         â”‚
â”‚  â”‚ Parser      â”‚    â”‚ Database    â”‚    â”‚ Interface   â”‚         â”‚
â”‚  â”‚             â”‚    â”‚             â”‚    â”‚             â”‚         â”‚
â”‚  â”‚ â€¢ Docling   â”‚â”€â”€â”€â–¶â”‚ â€¢ MilvusDB  â”‚â”€â”€â”€â–¶â”‚ â€¢ Ollama    â”‚         â”‚
â”‚  â”‚ â€¢ pdfPlumberâ”‚    â”‚ â€¢ Embedding â”‚    â”‚ â€¢ Models    â”‚         â”‚
â”‚  â”‚ â€¢ Chunking  â”‚    â”‚ â€¢ Reranking â”‚    â”‚ â€¢ Inference â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚         â”‚                   â”‚                   â”‚               â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                             â”‚                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ Text        â”‚    â”‚ RAG         â”‚    â”‚ Chain       â”‚         â”‚
â”‚  â”‚ Embedding   â”‚    â”‚ Pipeline    â”‚    â”‚ Orchestratorâ”‚         â”‚
â”‚  â”‚             â”‚    â”‚             â”‚    â”‚             â”‚         â”‚
â”‚  â”‚ â€¢ Models    â”‚    â”‚ â€¢ Retrieval â”‚    â”‚ â€¢ LabChain  â”‚         â”‚
â”‚  â”‚ â€¢ Encoding  â”‚    â”‚ â€¢ Generationâ”‚    â”‚ â€¢ Workflow  â”‚         â”‚
â”‚  â”‚ â€¢ Similarityâ”‚    â”‚ â€¢ Prompting â”‚    â”‚ â€¢ Metrics   â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
rag-pipeline-lab/
â”œâ”€â”€ main.py                 # ë©”ì¸ ì‹¤í–‰ íŒŒì¼
â”œâ”€â”€ document_parser.py      # ë¬¸ì„œ íŒŒì‹± ëª¨ë“ˆ
â”œâ”€â”€ vectordb.py            # ë²¡í„° ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬
â”œâ”€â”€ rag.py                 # RAG íŒŒì´í”„ë¼ì¸ êµ¬í˜„
â”œâ”€â”€ llm.py                 # LLM ì¸í„°í˜ì´ìŠ¤
â”œâ”€â”€ text_embedding.py      # í…ìŠ¤íŠ¸ ì„ë² ë”© ëª¨ë“ˆ
â”œâ”€â”€ chain.py               # ì²´ì¸ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„°
â”œâ”€â”€ models/                # ë¡œì»¬ ëª¨ë¸ ì €ì¥ì†Œ
â”‚   â””â”€â”€ ggml-model-Q5_K_M/
â”œâ”€â”€ metric/                # í‰ê°€ ë©”íŠ¸ë¦­
â”œâ”€â”€ venv/                  # ê°€ìƒí™˜ê²½
â””â”€â”€ README.md              # í”„ë¡œì íŠ¸ ë¬¸ì„œ
```

## ğŸ”§ ëª¨ë“ˆë³„ ê¸°ëŠ¥

### 1. Document Parser (`document_parser.py`)
- **Docling**: í•˜ì´ë¸Œë¦¬ë“œ ì²­í‚¹ì„ ì‚¬ìš©í•œ ë¬¸ì„œ íŒŒì‹±
- **pdfPlumber**: PDF í…ìŠ¤íŠ¸ ì¶”ì¶œ ë° ì²­í‚¹
- ì¶”ìƒ í´ë˜ìŠ¤ ê¸°ë°˜ìœ¼ë¡œ í™•ì¥ ê°€ëŠ¥í•œ êµ¬ì¡°

### 2. Vector Database (`vectordb.py`)
- **MilvusDB**: Milvus ë²¡í„° ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬
- ì„ë² ë”© ëª¨ë¸ í†µí•© (HuggingFace)
- ì¬ìˆœìœ„í™”(Re-ranking) ê¸°ëŠ¥
- ì»¨í…ìŠ¤íŠ¸ ì••ì¶• ê²€ìƒ‰ê¸°

### 3. RAG Pipeline (`rag.py`)
- RAG íŒŒì´í”„ë¼ì¸ ì„¤ì • ë° ê´€ë¦¬
- í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ ê´€ë¦¬
- ì»¨í…ìŠ¤íŠ¸ ì²˜ë¦¬ ë¡œì§

### 4. LLM Interface (`llm.py`)
- **Ollama**: ë¡œì»¬ LLM ëª¨ë¸ ê´€ë¦¬
- ëª¨ë¸ ë¡œë”© ë° ì¶”ë¡  ì¸í„°í˜ì´ìŠ¤
- ë‹¤ì–‘í•œ ëª¨ë¸ ì§€ì›

### 5. Text Embedding (`text_embedding.py`)
- í…ìŠ¤íŠ¸ ì„ë² ë”© ëª¨ë¸ ê´€ë¦¬
- ë²¡í„°í™” ë° ìœ ì‚¬ë„ ê³„ì‚°

### 6. Chain Orchestrator (`chain.py`)
- ì „ì²´ RAG ì›Œí¬í”Œë¡œìš° ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜
- ëª¨ë“ˆ ê°„ ì—°ê²° ë° ë°ì´í„° íë¦„ ê´€ë¦¬

## ğŸš€ ì‚¬ìš©ë²•

### 1. í™˜ê²½ ì„¤ì •
```bash
# ê°€ìƒí™˜ê²½ í™œì„±í™”
source venv/bin/activate

# ì˜ì¡´ì„± ì„¤ì¹˜
pip install -r requirements.txt

# í™˜ê²½ë³€ìˆ˜ ì„¤ì •
cp .env.example .env
# .env íŒŒì¼ì— í•„ìš”í•œ ì„¤ì • ì¶”ê°€
```

### 2. ê¸°ë³¸ ì‹¤í–‰
```bash
python main.py
```

### 3. ëª¨ë“ˆë³„ í…ŒìŠ¤íŠ¸
```bash
# ë¬¸ì„œ íŒŒì‹± í…ŒìŠ¤íŠ¸
python document_parser.py

# ë²¡í„° DB í…ŒìŠ¤íŠ¸
python vectordb.py

# LLM í…ŒìŠ¤íŠ¸
python llm.py
```

## âš™ï¸ í™˜ê²½ ë³€ìˆ˜

`.env` íŒŒì¼ì— ë‹¤ìŒ ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤:

```env
EMBED_MODEL=BAAI/bge-m3
RERANKER_MODEL=Alibaba-NLP/gte-multilingual-reranker-base
DB_ADDRESS=localhost:19530
LLM_MODEL=llama2
```

## ğŸ”¬ ì‹¤í—˜ ê¸°ëŠ¥

### 1. ë¬¸ì„œ íŒŒì‹± ì‹¤í—˜
- ë‹¤ì–‘í•œ ì²­í‚¹ í¬ê¸° ë° ì˜¤ë²„ë© ì„¤ì •
- ì—¬ëŸ¬ íŒŒì„œ ë¹„êµ (Docling vs pdfPlumber)
- ì²­í‚¹ í’ˆì§ˆ í‰ê°€

### 2. ì„ë² ë”© ì‹¤í—˜
- ë‹¤ì–‘í•œ ì„ë² ë”© ëª¨ë¸ ë¹„êµ
- ì„ë² ë”© í’ˆì§ˆ ë° ì„±ëŠ¥ ì¸¡ì •
- ë²¡í„° ìœ ì‚¬ë„ ë¶„ì„

### 3. ê²€ìƒ‰ ì‹¤í—˜
- ì¬ìˆœìœ„í™” ëª¨ë¸ ì„±ëŠ¥ ë¹„êµ
- ê²€ìƒ‰ ì •í™•ë„ ë° ì¬í˜„ìœ¨ ì¸¡ì •
- ì»¨í…ìŠ¤íŠ¸ ì••ì¶• íš¨ê³¼ ë¶„ì„

### 4. ìƒì„± ì‹¤í—˜
- ë‹¤ì–‘í•œ LLM ëª¨ë¸ ë¹„êµ
- í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§ ì‹¤í—˜
- ì‘ë‹µ í’ˆì§ˆ í‰ê°€

## ğŸ“Š í‰ê°€ ë©”íŠ¸ë¦­

- **ê²€ìƒ‰ ì •í™•ë„**: Precision@K, Recall@K
- **ìƒì„± í’ˆì§ˆ**: BLEU, ROUGE, BERTScore
- **ì‘ë‹µ ê´€ë ¨ì„±**: Semantic Similarity
- **ì‹¤í–‰ ì‹œê°„**: Latency ì¸¡ì •

## ğŸ› ï¸ ê°œë°œ ê°€ì´ë“œ

### ìƒˆë¡œìš´ íŒŒì„œ ì¶”ê°€
```python
class NewParser(Document):
    def __init__(self):
        super().__init__()
        self.model_name = "NewParser"
    
    def document_parsing(self, file_path, chunk_size, overlap):
        # êµ¬í˜„ ë¡œì§
        pass
```

### ìƒˆë¡œìš´ ë²¡í„° DB ì¶”ê°€
```python
class NewVectorDB:
    def __init__(self, embed_model, reranker_model, db_address):
        # ì´ˆê¸°í™” ë¡œì§
        pass
    
    def insert_vector_store(self, document):
        # ì‚½ì… ë¡œì§
        pass
```
